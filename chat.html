<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat com Diretoria - ETEC Takashi Morita</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="chat.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Header Oficial CPS Atualizado -->
    <header class="cps-header">
        <!-- Faixa do Governo SP -->
        <div class="governo-sp-banner">
            <div class="governo-banner-container">
                <div class="governo-content">
                    <div class="governo-logo-container">
                        <img src="logo-governo-do-estado-sp.png" 
                             alt="Governo do Estado de São Paulo" class="governo-logo">
                    </div>
                    <span class="governo-text">Governo do Estado de São Paulo</span>
                </div>
                
                <!-- Controles de Redes Sociais e Zoom -->
                <div class="header-controls">
                    <div class="social-icons">
                        <a href="#" class="social-link">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="#" class="social-link">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="social-link">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="social-link">
                            <i class="fab fa-youtube"></i>
                        </a>
                    </div>
                    <div class="zoom-controls">
                        <button class="zoom-btn" id="zoom-out" title="Diminuir zoom">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <button class="zoom-btn" id="zoom-in" title="Aumentar zoom">
                            <i class="fas fa-search-plus"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Header Principal CPS -->
        <div class="cps-main-header">
            <div class="container">
                <div class="header-main-content">
                    <!-- Logos CPS + ETEC -->
                    <div class="logos-container">
                        <a href="https://www.cps.sp.gov.br" class="logo-link">
                            <img src="centro-paula-souza-logo.svg" 
                                 alt="Centro Paula Souza" class="cps-logo">
                        </a>

                        <div class="divider"></div>

                        <a href="#" class="logo-link">
                            <img src="Etec.png" alt="ETEC Takashi Morita" class="etec-logo">
                        </a>
                    </div>

                    <!-- Indicador de Usuário -->
                    <div class="user-indicator">
                        <span id="userRole" class="user-role"></span>
                        <span id="userName" class="user-name"></span>
                        <button id="logoutBtn" class="cps-button outline small" style="display: none;">
                            <i class="fas fa-sign-out-alt"></i>
                            Sair
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Chat para Alunos -->
    <div id="studentChat" class="layout-container student-view" style="display: none;">
        <main class="chat-main-content">
            <div class="chat-header-section">
                <div class="chat-title">
                    <h1>
                        <i class="fas fa-comments"></i>
                        Chat com a Diretoria
                    </h1>
                    <p class="chat-subtitle">Comunicação direta com a equipe diretiva da escola</p>
                </div>
                
                <div class="chat-stats">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Status</h3>
                            <p id="onlineNow">Online</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-id-card"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Seu RM</h3>
                            <p id="studentRMDisplay">-</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chat-interface">
                <!-- Sidebar de Departamentos -->
                <aside class="chat-sidebar">
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">
                            <i class="fas fa-users"></i>
                            Setores da Diretoria
                        </h3>
                        
                        <div class="department-list">
                            <div class="department-item active" data-department="all">
                                <div class="dept-icon">
                                    <i class="fas fa-building"></i>
                                </div>
                                <div class="dept-info">
                                    <h4>Diretoria</h4>
                                    <span class="dept-status online">Online</span>
                                </div>
                            </div>
                            
                        
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h4 class="sidebar-title">
                            <i class="fas fa-bolt"></i>
                            Ações Rápidas
                        </h4>
                        <div class="quick-actions">
                            <button class="cps-button outline quick-btn" onclick="sendQuickMessage('agendamento')">
                                <i class="fas fa-calendar-check"></i>
                                Agendar Reunião
                            </button>
                            <button class="cps-button outline quick-btn" onclick="sendQuickMessage('documento')">
                                <i class="fas fa-file-pdf"></i>
                                Solicitar Documento
                            </button>
                            <button class="cps-button outline quick-btn" onclick="sendQuickMessage('duvida')">
                                <i class="fas fa-question-circle"></i>
                                Tirar Dúvida
                            </button>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <div class="chat-info">
                            <div class="info-item">
                                <i class="fas fa-clock"></i>
                                <span>Horário de Atendimento: 7h-18h</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-phone"></i>
                                <span>Emergência: (11) 99999-9999</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-envelope"></i>
                                <span>Email: e300@cps.sp.gov.br</span>
                            </div>
                        </div>
                    </div>
                </aside>

                <!-- Área Principal do Chat -->
                <section class="chat-main-area">
                    <!-- Cabeçalho do Chat -->
                    <div class="chat-conversation-header">
                        <div class="conversation-partner">
                            <div class="partner-avatar">
                                <i class="fas fa-school"></i>
                            </div>
                            <div class="partner-info">
                                <h3>Diretoria Escolar</h3>
                                <span class="partner-status online">Online - Respondendo agora</span>
                            </div>
                        </div>
                        
                        <div class="conversation-actions">
                            <button class="cps-button icon-btn" onclick="refreshChat()" title="Atualizar">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Container de Mensagens -->
                    <div class="messages-container" id="messagesContainer">
                        <div class="welcome-message">
                            <div class="welcome-icon">
                                <i class="fas fa-comments"></i>
                            </div>
                            <h3>Bem-vindo ao Chat com a Diretoria!</h3>
                            <p>Inicie uma conversa enviando uma mensagem abaixo.</p>
                        </div>
                    </div>

                    <!-- Indicador de Digitação -->
                    <div class="typing-indicator" id="typingIndicator">
                        <div class="typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        <span>Diretoria está digitando...</span>
                    </div>

                    <!-- Área de Input de Mensagem -->
                    <div class="message-input-area">
                        <div class="input-container">
                            <textarea 
                                id="messageInput" 
                                placeholder="Digite sua mensagem para a diretoria..."
                                rows="1"
                                class="cps-textarea"
                            ></textarea>
                            <button class="cps-button primary send-btn" onclick="sendStudentMessage()" title="Enviar mensagem">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Chat para Administrador -->
    <div id="adminChat" class="layout-container admin-view" style="display: none;">
        <main class="chat-main-content">
            <div class="chat-header-section">
                <div class="chat-title">
                    <h1>
                        <i class="fas fa-comments"></i>
                        Chat Administrativo
                    </h1>
                    <p class="chat-subtitle">Gerenciamento de conversas com os alunos</p>
                </div>
                
                <div class="chat-stats">
                    
                    <
                </div>
            </div>

            <div class="chat-interface">
                <!-- Sidebar de Alunos Conectados -->
                <aside class="chat-sidebar">
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">
                            <i class="fas fa-user-graduate"></i>
                            Alunos Conectados
                        </h3>
                        
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="studentSearch" placeholder="Buscar aluno por RM ou nome..." class="search-input">
                        </div>
                        
                        <div class="department-list" id="studentsList">
                            <!-- Alunos serão carregados aqui via JavaScript -->
                            <div class="loading-students">
                                <i class="fas fa-spinner fa-spin"></i>
                                <span>Carregando alunos...</span>
                            </div>
                        </div>
                    </div>

              
                </aside>

                <!-- Área Principal do Chat Admin -->
                <section class="chat-main-area">
                    <!-- Cabeçalho do Chat -->
                    <div class="chat-conversation-header">
                        <div class="conversation-partner">
                            <div class="partner-avatar">
                                <i class="fas fa-user-graduate"></i>
                            </div>
                            <div class="partner-info">
                                <h3 id="selectedStudentName">Selecione um aluno</h3>
                                <span class="partner-status" id="selectedStudentStatus">Clique em um aluno para conversar</span>
                            </div>
                        </div>
                        
                        <div class="conversation-actions">
                            <button class="cps-button icon-btn" onclick="refreshAdminChat()" title="Atualizar">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Container de Mensagens -->
                    <div class="messages-container" id="adminMessagesContainer">
                        <div class="welcome-message">
                            <div class="welcome-icon">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            <h3>Modo Administrativo</h3>
                            <p>Selecione um aluno na lista ao lado para iniciar uma conversa.</p>
                        </div>
                    </div>

                    <!-- Indicador de Digitação -->
                    <div class="typing-indicator" id="adminTypingIndicator">
                        <div class="typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        <span id="adminTypingText">Aluno está digitando...</span>
                    </div>

                    <!-- Área de Input de Mensagem -->
                    <div class="message-input-area">
                        <div class="input-container">
                            <textarea 
                                id="adminMessageInput" 
                                placeholder="Digite sua mensagem para o aluno..."
                                rows="1"
                                class="cps-textarea"
                                disabled
                            ></textarea>
                            <button class="cps-button primary send-btn" onclick="sendAdminMessage()" title="Enviar mensagem" id="adminSendBtn" disabled>
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Modal de Confirmação -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <h3>Confirmação</h3>
            <p id="confirmMessage">Tem certeza que deseja realizar esta ação?</p>
            <div class="modal-actions">
                <button class="cps-button primary" onclick="confirmAction()">Sim, Confirmar</button>
                <button class="cps-button secondary" onclick="closeModal()">Cancelar</button>
            </div>
        </div>
    </div>
    
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="chat.js"></script>
</body>

</html>
